# AirChat - Текстовый и голосовой чат

## Описание проекта

AirChat - это многофункциональное приложение для текстового и голосового общения, разработанное с использованием Go для серверной и клиентской логики и Electron для создания кроссплатформенного пользовательского интерфейса. Приложение позволяет пользователям создавать комнаты, обмениваться текстовыми сообщениями и участвовать в голосовых чатах.

## Основные функции

*   **Текстовый чат:** Обмен сообщениями в режиме реального времени.
*   **Голосовой чат:** Возможность голосового общения с другими пользователями в комнате.
*   **Создание комнат:** Пользователи могут создавать собственные чат-комнаты.
*   **Управление сервером:** Интерфейс для запуска и остановки сервера непосредственно из приложения.
*   **Список пользователей:** Отображение списка подключенных пользователей.
*   **Автоматические статусы пользователей:** Индикация статуса пользователей (например, "в сети", "пишет сообщение").
*   **Кастомизация интерфейса:**
    *   Переключатель тем (светлая, темная и другие).
    *   Сохранение выбранной темы в localStorage.
    *   Стильный и современный дизайн.
*   **Аутентификация:** Базовая система для предотвращения конфликтов имен пользователей.
*   **Кроссплатформенность:** Благодаря Electron, приложение может работать на различных операционных системах.

## Используемые технологии

*   **Go (Golang):** Для разработки серверной части и основной логики клиента.
*   **Electron:** Для создания настольного приложения с использованием веб-технологий (HTML, CSS, JavaScript).
*   **HTML, CSS, JavaScript:** Для построения пользовательского интерфейса.
*   **Opus Codec:** Для кодирования и декодирования аудио в голосовом чате.
*   **PortAudio:** Кроссплатформенная библиотека для работы с аудио.
*   **Windows Firewall API (через команды PowerShell):** Для настройки правил брандмауэра при первом запуске сервера.

## Установка и запуск

1.  **Сборка проекта:** Для сборки проекта необходимы Go и Node.js (с npm).
    *   Скомпилируйте Go-сервер (`src/go_server/main.go`) и Go-клиент (`src/go_client/main.go`).
    *   Установите зависимости Electron-приложения (`npm install`).
2.  **Запуск в режиме разработки:**
    *   Запустите скомпилированный сервер.
    *   Запустите Electron-приложение (`npm start`).
3.  **Создание установщика:**
    *   Проект настроен для сборки `Setup.exe` с помощью `electron-builder`. Конфигурация сборки находится в `package.json`.
    *   Установщик автоматически включает необходимые DLL (Opus, PortAudio).
    *   Выполните команду `npm run dist` для создания установщика.
4.  **Первый запуск сервера из приложения:** При первом создании комнаты (запуске сервера) приложение предложит добавить правила в брандмауэр Windows для UDP-портов 6000 (текстовый чат) и 6001 (голосовой чат).

## Журнал изменений (Changelog)

Этот раздел подробно описывает историю разработки, внедренные функции и исправленные ошибки.

### Ранний этап разработки и базовый функционал

*   **Инициализация проекта:** Создана основа приложения с использованием Electron и Go.
*   **Базовый текстовый чат:** Реализована отправка и получение текстовых сообщений.
*   **Начальная интеграция голосового чата:** Предприняты первые шаги по внедрению голосовой связи.
*   **Исправление кодировки:** Устранены проблемы с отображением русского текста (UTF-8).
*   **Конфигурация сервера и сети:**
    *   Решены проблемы с подключением к серверу.
    *   Добавлена логика для автоматической настройки правил брандмауэра Windows для портов UDP 6000 и 6001 при первом запуске сервера.

### Улучшения пользовательского интерфейса (UI/UX)

*   **Стилизация главного меню:** Обновлен дизайн главного меню для более современного вида.
*   **Исправление полей ввода:** Устранены проблемы с неработающими полями ввода IP-адреса и имени пользователя.
*   **Управление запуском сервера:** Сервер теперь запускается по нажатию кнопки "Создать комнату", а не автоматически.
*   **Перенаправление на экран управления сервером:** После создания комнаты пользователь автоматически перенаправляется в окно управления сервером.
*   **Центрирование меню входа:** Элементы формы входа были отцентрированы для лучшего визуального восприятия.
*   **Заголовок "Sign in":** Добавлен серый заголовок "Sign in" на форму входа.
*   **Переключатель тем:**
    *   Реализован функционал смены тем оформления (светлая, темная, пользовательские).
    *   Выбранная тема сохраняется в `localStorage`.
    *   Изначально панель с темами была заменена на одну кнопку в заголовке для циклического переключения тем.
*   **Дизайн чата:**
    *   Боковая панель чата (`chat-sidebar`) сделана округлой.
    *   Реализовано наложение боковой панели на область чата для экономии пространства.
    *   Область чата получила фиксированные размеры и полосу прокрутки, предотвращая ее расширение при добавлении новых сообщений.
*   **Локализация комментариев:** Комментарии в CSS-файлах переведены на русский язык.

### Развитие и оптимизация голосового чата

*   **Начальное устранение проблем со звуком:** Решены проблемы, когда пользователи слышали тестовый звук, но не друг друга.
*   **Улучшение обработки аудио на сервере:** Модифицирована логика сервера для более стабильной передачи голосовых данных.
*   **Оптимизация качества звука:**
    *   Настроены пороговые значения усиления (gain thresholds).
    *   Улучшена работа с аудио буферами.
    *   Произведены корректировки настроек кодека Opus.
    *   Увеличены битрейт и размер буфера для повышения качества звука.
*   **Многопользовательский режим:**
    *   Внедрено клиентское микширование аудио для обработки нескольких голосовых потоков.
    *   Рассмотрены и частично внедрены механизмы эхоподавления (на базе WebRTC AEC) и детекции голосовой активности (WebRTC VAD).
    *   Улучшено управление потоками на стороне сервера.
*   **Исправление искажений и отсутствия звука:** Проведен ряд работ по устранению проблем с полным отсутствием звука или его сильными искажениями.
*   **Буферизация и упорядочивание пакетов:** Внедрены механизмы для упорядочивания аудиопакетов и управления джиттер-буфером для сглаживания передачи звука.
*   **Усиление микрофона:** Адресованы проблемы с тихим звуком от микрофона.
*   **Оптимизация производительности:** Использован `sync.Pool` в Go для оптимизации выделения памяти при обработке аудио.
*   **Корректировка задержек звука:** Внесены изменения для уменьшения задержек при голосовом общении.

### Функциональные доработки и бэкенд

*   **Привязка команд к кнопкам:** Реализована отправка команд (`/voice`, `/leave`, `/exit`) на сервер при нажатии соответствующих кнопок в интерфейсе.
*   **Рефакторинг Go-кода:** Создана структура `AppController` в Go для инкапсуляции логики команд и упрощения взаимодействия с UI.
*   **Улучшение остановки сервера:** Доработана логика остановки сервера и добавлено подробное логирование.
*   **Статус развертывания сервера:** Исправлены проблемы с отображением корректного статуса сервера в UI (анализ `stderr` и `stdout`).
*   **Настройка окружения:** Обеспечена корректная работа с компилятором GCC.
*   **Автоматические статусы пользователей:** Внедрена система автоматического обновления статусов пользователей (например, "Online", "Offline", "Voice - Talking").
*   **Список пользователей:** Реализовано отображение списка активных пользователей в комнате.
*   **Аутентификация пользователей:** Добавлена базовая проверка имен пользователей для предотвращения ошибки "USERNAME_TAKEN".
*   **Фильтрация системных сообщений:** На стороне сервера добавлена логика для предотвращения отображения нежелательных системных сообщений (например, о подключении/отключении) в основном чате.

### Сборка, развертывание и исправление ошибок

*   **Управление зависимостями (DLL):**
    *   Настроена сборка установщика `Setup.exe` для включения необходимых DLL (Opus, PortAudio).
    *   Файл `package.json` обновлен для корректного копирования `extraResources`.
    *   Установлено `asar: false` для правильной работы с внешними исполняемыми файлами.
*   **Пути к исполняемым файлам:** Исправлены пути к `server.exe` и `client.exe` для корректной работы как в режиме разработки, так и в упакованном приложении (использование `process.resourcesPath`).
*   **Тестирование установщика:** Проверена работоспособность `Setup.exe` на "чистой" системе.
*   **Устранение критических ошибок:**
    *   Исправлена ошибка "Unhandled Promise Rejection" в Electron.
    *   Устранена ошибка "Server executable not found" в упакованном приложении.
*   **Запуск `client.exe`:** Обеспечен корректный запуск `client.exe` при нажатии кнопки "Connect".

### Управление версиями и коммиты

*   Проект регулярно коммитился в систему контроля версий Git, включая фиксацию всех значимых изменений на ветке `master`.

Этот журнал изменений отражает основные этапы разработки и демонстрирует эволюцию проекта AirChat от базовой концепции до многофункционального приложения. 